stages:
  - build

build:
  tags:
    - shell
    
  stage: build

  before_script:
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u $CI_REGISTRY_USER --password-stdin $CI_REGISTRY

  script:
    - |
      docker build . \
          -t $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_NAME \
          --build-arg BUILD_VERSION="$CI_COMMIT_REF_SLUG-$CI_PIPELINE_IID" \
          --build-arg BUILD_DATE="$(date +%Y%m%d_%H%M%S)"
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_NAME
